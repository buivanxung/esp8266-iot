<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <!-- Required meta tags -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width"/>
    <title> Technology</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="js/modernizr-3.5.0.min.js"></script>
    <script src="js/jquery-1.12.4.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
      var socket;
      var allValue = 100;
      var allData = {'D0':0,'D1':0,'D2':0,'D3':0,'D4':0,'D5':0,'D6':0,'D7':0,'D8':0,'D9':0,'D10':0,'D11':0,
      'D12':0,'D13':0,'D14':0,'D15':0,'D16':0,'D17':0,'D18':0,'D19':0,'D20':0,'D21':0,'D22':0,'D23':0};
       $(document).ready(function() {
        socket = io.connect('http://34.74.202.175:8448',{
          reconnection: true,
          reconnectionDelay: 1000,
          reconnectionDelayMax : 5000,
          reconnectionAttempts: 99999
        });
        for (i = 0; i < allValue; i++) {
          $('#main').prepend("<div class=\"text-center\"><label for=\"\">Pin D"+i+"</label><div class=\"onoffswitch\"><input type=\"checkbox\" name=\"onoffswitch\" class=\"onoffswitch-checkbox\" id=\"myonoffswitch"+i+"\" checked value = "+i+"><label class=\"onoffswitch-label\" for=\"myonoffswitch"+i+"\"><span class=\"onoffswitch-inner\"></span><span class=\"onoffswitch-switch\"></span></label></div></div>");
        }
        socket.on('sending_json_data', function (data) {
          if (data != null){
            var raw = data.toString().split(':');
            if(allData.hasOwnProperty(raw[0])){
              allData[raw[0]] = raw[1];
            }
            
            if (allData[raw[0]] == 1) {
              $("input[id='myonoffswitch"+raw[0]+"']").is(':checked');
            }else if (allData[raw[0]] == 0) {
              $("input[id='myonoffswitch"+raw[0]+"']").attr('checked',false);
            }
          }
        });
        $("input[name='onoffswitch']").click(function(e){
          var position = e.target.defaultValue;
            if ($("input[id='myonoffswitch"+position+"']").is(':checked')) {
              if (socket) {
                  socket.emit('respond_command', "D"+position+":1");
                  console.log("D"+position+"PON");
                }
            }else {
              if (socket) {
                  socket.emit('respond_command', "D"+position+":0");
                  console.log("D"+position+"POFF");
                }
            }
        })
    });
  </script>
</head>
<body>
  <div class="body">
    <div class="text-center">
      <p>Control</p>
    </div>
    <div id ="main" class="text-center">
    </div>
  </div>
</body>
</html>
