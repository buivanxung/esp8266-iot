<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <!-- Required meta tags -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width"/>
    <title> Technology</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="js/modernizr-3.5.0.min.js"></script>
    <script src="js/jquery-1.12.4.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
      var socket;
      var allValue = 50;
      var allData = "";
       $(document).ready(function() {
          socket = io.connect('http://34.74.202.175:8448',{
          reconnection: true,
          reconnectionDelay: 1000,
          reconnectionDelayMax : 5000,
          reconnectionAttempts: 99999
        });
        for (i = 0; i < allValue; i++) {
          $('#main').prepend("<div class=\"form_text\"><div class=\"text-center\"><label for=\"\">Pin D"+i+"</label><div class=\"onoffswitch\"><input type=\"checkbox\" name=\"onoffswitch\" class=\"onoffswitch-checkbox\" id=\"myonoffswitch"+i+"\" value = "+i+"><label class=\"onoffswitch-label\" for=\"myonoffswitch"+i+"\"><span class=\"onoffswitch-inner\"></span><span class=\"onoffswitch-switch\"></span></label></div></div></div>");
        }
        socket.on('sending_json_data', function (data) {
          if (data != null){
            console.log(data);
            
            var raw = data.toString().split(':');
            var enumber = raw[0].split('D');
            console.log(enumber);
            
            if(allData.hasOwnProperty(raw[0])){
              allData[raw[0]] = raw[1];
            if (allData[raw[0]] == "0") {
              $("input[id='myonoffswitch"+enumber[1]+"']").attr('checked',false);
            }else if (allData[raw[0]] == "1") {
              $("input[id='myonoffswitch"+enumber[1]+"']").prop('checked',true);
            }}}
        });
        socket.on('alldata',function (data) {
          allData = data;
          for (i = 0 ;i < allValue; i++){
            if (allData["D"+i] == "1") {
              $("input[id='myonoffswitch"+i+"']").attr('checked',true);
            }else if (allData["D"+i] == "0") {
              $("input[id='myonoffswitch"+i+"']").attr('checked',false);
            }
          }
        })
        $("input[name='onoffswitch']").click(function(e){
          var position = e.target.defaultValue;
            if ($("input[id='myonoffswitch"+position+"']").is(':checked')) {
              if (socket) {
                  socket.emit('respond_command', "D"+position+":1");
                }
            }else {
              if (socket) {
                  socket.emit('respond_command', "D"+position+":0");
                }
            }
        })
    });
  </script>
</head>
<body>
  <div class="body">
    <div class="text-center">
      <h1>Control Devices</h1>
    </div>
    <div id ="main" class="text-center">
    </div>
  </div>
</body>
</html>
